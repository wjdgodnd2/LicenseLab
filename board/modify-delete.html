<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>게시판 - 수정 및 삭제</title>
</head>
<!DOCTYPE html>
    <html lang="ko">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>게시판 - 수정 및 삭제</title>
        <link rel="stylesheet" href="/LicenseLab/css/modify.css">
        <script src="/LicenseLab/js/server.js" defer></script>
    </head>
<body>
    <div class="board_wrap">
        <div class="board_title">
            <strong>게시판</strong>
            <p>게시판을 빠르고 정확하게 안내해드립니다.</p>
        </div>
        <div class="board_view_wrap">
            <div class="board_view">
                <form id="modifyForm">
                    <div class="title">
                        <dl>
                            <dt>제목</dt>
                            <dd><input type="text" id="titleInput" placeholder="수정할 제목 입력"></dd>
                        </dl>
                    </div>
                    <div class="info">
                        <dl>
                            <dt>글쓴이</dt>
                            <dd><input type="text" id="writerInput" placeholder="수정할 글쓴이 입력"></dd>
                        </dl>
                        <dl>
                            <dt>비밀번호</dt>
                            <dd><input type="password" id="passwordInput" placeholder="비밀번호 입력"></dd>
                        </dl>
                    </div>
                    <div class="cont">
                        <textarea id="contentInput" placeholder="수정할 내용 입력"></textarea>
                    </div>
                </form>
            </div>
            <div class="bt_wrap">
                <button type="button" onclick="submitModify()">수정</button>
                <button type="button" onclick="submitDelete()">삭제</button>
                <a href="list.html">취소</a>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // URL에서 게시물 ID 추출
            const urlParams = new URLSearchParams(window.location.search);
            const postId = urlParams.get('postId');
    
            // 게시물 세부 정보를 가져와 기존 데이터로 폼 필드를 채웁니다.
            fetch(`http://localhost:3000/api/posts/${postId}`)
                .then(response => response.json())
                .then(post => {
                    document.getElementById('titleInput').value = post.title;
                    document.getElementById('writerInput').value = post.writer;
                    // 비밀번호는 초기화하지 않도록 수정
                    // document.getElementById('passwordInput').value = '';
                    document.getElementById('contentInput').value = post.content;
                })
                .catch(error => {
                    console.error('게시글 정보를 가져오는 데 실패했습니다.', error);
                });
    
            function submitModify() {
                const title = document.getElementById('titleInput').value;
                const writer = document.getElementById('writerInput').value;
                const password = document.getElementById('passwordInput').value;
                const content = document.getElementById('contentInput').value;
    
                fetch(`http://localhost:3000/api/posts/${postId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        title: title,
                        writer: writer,
                        password: password, // 비밀번호도 전송
                        content: content,
                    }),
                })
                .then(response => response.json())
                .then(post => {
                    window.location.href = 'list.html';
                })
                .catch(error => {
                    console.error('게시글을 수정하는 데 실패했습니다.', error);
                });
            }
    
            function submitDelete() {
                fetch(`http://localhost:3000/api/posts/${postId}`, {
                    method: 'DELETE',
                })
                .then(response => response.json())
                .then(() => {
                    window.location.href = 'list.html';
                })
                .catch(error => {
                    console.error('게시글을 삭제하는 데 실패했습니다.', error);
                });
            }
        });
    </script>
</body>
</html>
